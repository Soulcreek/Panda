<div class="admin-nav bg-white border-bottom mb-4 editors-nav-shell">
  <div class="container">
    <% if (typeof dbHealth !== 'undefined' && dbHealth && (dbHealth.degraded || (dbHealth.lastPingMs && dbHealth.lastPingMs > dbHealth.slowThresholdMs))) { %>
      <div id="db-health-banner" class="alert py-1 px-2 mb-2 <%= dbHealth.lastError ? 'alert-danger' : 'alert-warning' %> small d-flex align-items-center gap-2" role="alert" style="animation:fadeSlide .4s ease;">
        <strong>DB</strong>
        <span><%= dbHealth.lastError ? ('Fehler: '+dbHealth.lastError) : ('Langsam ('+dbHealth.lastPingMs+'ms, Ø '+(dbHealth.rollingAvgMs||'?')+'ms)') %></span>
        <span class="text-muted">slow: <%= dbHealth.slowQueries %>/<%= dbHealth.totalQueries %></span>
        <button type="button" class="btn btn-sm btn-outline-secondary ms-auto" id="dbHealthRefreshBtn">Neu prüfen</button>
      </div>
    <% } else { %>
      <div id="db-health-banner" class="d-none"></div>
    <% } %>
    <nav class="d-flex flex-wrap align-items-stretch gap-3 py-2">
      <a class="nav-link px-2" href="/editors">Dashboard</a>
      <a class="nav-link px-2" href="/editors/posts">Beiträge</a>
      <a class="nav-link px-2" href="/editors/media">Medien</a>
      <a class="nav-link px-2" href="/editors/podcasts">Podcasts</a>
      <a class="nav-link px-2" href="/editors/advanced-pages">Advanced Pages</a>
      <a class="nav-link px-2" href="/editors/timeline-editor">Timeline</a>
  <a class="btn btn-sm btn-outline-warning" href="/admin">Settings Center</a>
      <a class="btn btn-sm btn-outline-danger ms-auto" href="/logout">Abmelden</a>
    </nav>
  </div>
</div>
<style>.editors-nav-shell{backdrop-filter:blur(6px);} .editors-nav-shell .nav-link{color:#444;} .editors-nav-shell .nav-link.active{font-weight:600;color:#0d6efd;}</style>
<script>(()=>{try{const p=window.location.pathname;document.querySelectorAll('.editors-nav-shell .nav-link').forEach(a=>{if(a.getAttribute('href')===p) a.classList.add('active');});}catch(e){}})();</script>
<script>
// DB Health Polling
(function(){
  const banner = document.getElementById('db-health-banner');
  const refreshBtn = document.getElementById('dbHealthRefreshBtn');
  function updateBanner(data){
    if(!banner) return;
    if(!data.degraded && (!data.lastPingMs || data.lastPingMs <= data.threshold)){
      banner.className='d-none';
      return;
    }
    banner.className='alert py-1 px-2 mb-2 small d-flex align-items-center gap-2 '+(data.lastError?'alert-danger':'alert-warning');
    banner.innerHTML='<strong>DB</strong> <span>'+ (data.lastError?('Fehler: '+data.lastError):('Langsam ('+data.lastPingMs+'ms)')) +'</span><button type="button" class="btn btn-sm btn-outline-secondary ms-auto" id="dbHealthRefreshBtn">Neu prüfen</button>';
    banner.querySelector('#dbHealthRefreshBtn').addEventListener('click',()=>ping(true));
  }
  async function ping(force){
    try { const r = await fetch('/admin/api/db-health'+(force?'?force=1':'') ,{headers:{'Accept':'application/json'}}); const d= await r.json(); if(d){ updateBanner(d); } } catch(_){ }
  }
  if(refreshBtn){ refreshBtn.addEventListener('click',()=>ping(true)); }
  setInterval(ping, 20000); // every 20s
})();
</script>
