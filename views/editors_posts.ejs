<%- include('partials/header') %>
<%- include('partials/editors_nav') %>
<div class="container my-5">
  <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
    <div class="d-flex align-items-center flex-wrap gap-3">
      <h1 class="mb-0"><%= archived ? 'Archivierte BeitrÃ¤ge' : 'BeitrÃ¤ge verwalten' %></h1>
      <a href="/editors/posts/new" class="btn btn-primary">Neuen Beitrag erstellen</a>
      <% if (!archived) { %>
        <a href="/editors/posts?archived=1" class="btn btn-sm btn-outline-secondary">Archiv anzeigen</a>
      <% } else { %>
        <a href="/editors/posts" class="btn btn-sm btn-outline-secondary">ZurÃ¼ck</a>
      <% } %>
    </div>
  </div>
  <div class="card"><div class="card-body">
    <table class="table table-striped mb-0">
      <thead><tr><th>Titel</th><th>Status</th><th>Featured</th><th>Plan / Aktualisiert</th><th>Aktionen</th></tr></thead>
      <tbody>
        <% if (posts && posts.length) { posts.forEach(post=>{ %>
        <tr class="<%= post.is_featured ? 'table-warning' : '' %>">
          <td><%= post.title %></td>
          <td><span class="badge bg-<%= post.status==='published'?'success':'secondary' %>"><%= post.status==='published' ? (post.published_at && new Date(post.published_at)>new Date() ? 'Geplant' : 'Live') : 'Entwurf' %></span></td>
          <td><% if(post.is_featured){ %><span class="badge bg-warning text-dark">Featured</span><% } %></td>
          <td>
            <% if (post.published_at) { %><div class="small" title="Geplanter/effektiver Zeitpunkt">ğŸ—“ <%= new Date(post.published_at).toLocaleString('de-DE') %></div><% } %>
            <div class="text-muted small" title="Zuletzt aktualisiert">âŸ³ <%= new Date(post.updated_at).toLocaleDateString('de-DE') %></div>
          </td>
          <td>
            <div class="btn-group btn-group-sm">
              <a href="/editors/posts/edit/<%= post.id %>" class="btn btn-outline-secondary">Edit</a>
              <% if(post.status==='published'){ %>
                <form action="/editors/posts/<%= post.id %>/draft" method="POST" class="js-unpublish"><input type="hidden" name="_csrf" value="<%= csrfToken %>"><button class="btn btn-outline-secondary">Unpublish</button></form>
              <% } else { %>
                <form action="/editors/posts/<%= post.id %>/publish" method="POST"><input type="hidden" name="_csrf" value="<%= csrfToken %>"><button class="btn btn-outline-success">Publish</button></form>
              <% } %>
              <form action="/editors/posts/<%= post.id %>/hide" method="POST" class="js-archive"><input type="hidden" name="_csrf" value="<%= csrfToken %>"><button class="btn btn-outline-warning">Archiv</button></form>
            </div>
          </td>
        </tr>
        <% }) } else { %>
          <tr><td colspan="5" class="text-center text-muted">Keine BeitrÃ¤ge</td></tr>
        <% } %>
      </tbody>
    </table>
  </div></div>
  <div class="mt-4"><a class="btn btn-sm btn-outline-secondary" href="/admin">Zum Settings Center</a></div>
</div>
<%- include('partials/footer') %>
<script nonce="<%= cspNonce %>">
document.querySelectorAll('form.js-unpublish').forEach(f=>{
  f.addEventListener('submit', e=>{ if(!window.confirm('Als Entwurf setzen?')) e.preventDefault(); });
});
document.querySelectorAll('form.js-archive').forEach(f=>{
  f.addEventListener('submit', e=>{ if(!window.confirm('Archivieren?')) e.preventDefault(); });
});
</script>
