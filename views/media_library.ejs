<%- include('partials/header') %>
<%- include('partials/admin_nav') %>

<div class="container my-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Medienbibliothek</h1>
    </div>

    <!-- Upload-Formular -->
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">Neue Datei hochladen</h5>
            <form action="/admin/upload" method="post" enctype="multipart/form-data">
                <!-- KORREKTUR: Das fehlende CSRF-Token wurde hinzugefÃ¼gt -->
                <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                <div class="input-group">
                    <input type="file" name="mediafile" class="form-control" required>
                    <button type="submit" class="btn btn-primary">Hochladen</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Medien-Raster -->
    <div class="row row-cols-2 row-cols-md-4 row-cols-lg-6 g-3">
        <% if (files && files.length > 0) { %>
            <% files.forEach(file => { %>
                <div class="col">
                    <div class="card h-100">
                        <a href="/admin/media/edit/<%= file.id %>" class="text-decoration-none text-dark">
                            <% if (file.type && file.type.startsWith('image/')) { %>
                                <img src="/uploads/<%= file.name %>" class="card-img-top" alt="<%= file.name %>" style="aspect-ratio: 1 / 1; object-fit: cover;">
                            <% } else { %>
                                <div class="d-flex justify-content-center align-items-center bg-light" style="aspect-ratio: 1 / 1;">
                                    <i class="bi bi-file-earmark-text" style="font-size: 2rem;"></i>
                                </div>
                            <% } %>
                            <div class="card-body p-2">
                                <p class="card-text small text-truncate"><%= file.name %></p>
                            </div>
                        </a>
                    </div>
                </div>
            <% }); %>
        <% } else { %>
            <p>Keine Dateien in der Medienbibliothek gefunden.</p>
        <% } %>
    </div>
</div>

<%- include('partials/footer') %>
