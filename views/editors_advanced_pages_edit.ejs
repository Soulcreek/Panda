<%- include('partials/header') %>
<%- include('partials/editors_nav') %>
<div class="container" data-aos="fade-in">
  <h1 class="h3 mb-4"><%= page? 'Advanced Page bearbeiten' : 'Neue Advanced Page' %></h1>
  <form method="POST" action="/editors/advanced-pages/save" id="advancedPageForm">
    <input type="hidden" name="id" value="<%= page? page.id:'' %>">
    <div class="mb-3">
      <label class="form-label">Titel</label>
      <input type="text" class="form-control" name="title" id="apTitle" value="<%= page? page.title:'' %>" required>
    </div>
    <div class="mb-3">
      <label class="form-label">Slug</label>
      <input type="text" class="form-control" name="slug" id="apSlug" value="<%= page? page.slug:'' %>" required>
    </div>
    <div class="row g-3 mb-3">
      <div class="col-md-6">
        <label class="form-label">SEO Title</label>
        <input type="text" class="form-control" name="seo_title" maxlength="255" value="<%= page? (page.seo_title||''):'' %>">
      </div>
      <div class="col-md-6">
        <label class="form-label">Meta Keywords (Komma getrennt)</label>
        <input type="text" class="form-control" name="meta_keywords" maxlength="255" value="<%= page? (page.meta_keywords||''):'' %>">
      </div>
      <div class="col-12">
        <label class="form-label">SEO Description</label>
        <textarea class="form-control" name="seo_description" rows="2" maxlength="255"><%= page? (page.seo_description||''):'' %></textarea>
        <div class="form-text">Kurze Beschreibung (max 155-180 Zeichen empfohlen)</div>
      </div>
      <div class="col-md-6">
        <label class="form-label">Meta Image URL</label>
        <input type="text" class="form-control" name="meta_image" value="<%= page? (page.meta_image||''):'' %>">
        <div class="form-text">Optionales Vorschaubild (absoluter oder relativer Pfad)</div>
      </div>
    </div>
    <div class="d-flex flex-wrap gap-2 mb-3">
      <button type="button" class="btn btn-sm btn-outline-primary ap-add-row" data-preset="full">+ Full</button>
      <button type="button" class="btn btn-sm btn-outline-primary ap-add-row" data-preset="two-equal">+ 50/50</button>
      <button type="button" class="btn btn-sm btn-outline-primary ap-add-row" data-preset="two-67-33">+ 67/33</button>
      <button type="button" class="btn btn-sm btn-outline-primary ap-add-row" data-preset="two-33-67">+ 33/67</button>
      <button type="button" class="btn btn-sm btn-outline-primary ap-add-row" data-preset="three">+ 3 Col</button>
      <button type="button" class="btn btn-sm btn-outline-secondary" id="apExpandAll">Expand</button>
      <button type="button" class="btn btn-sm btn-outline-secondary" id="apCollapseAll">Collapse</button>
      <button type="button" class="btn btn-sm btn-outline-secondary" id="apJSONToggle">Layout JSON</button>
    </div>
    <div id="apBuilder" class="mb-4"></div>
    <div class="mb-3 d-none" id="apJsonWrapper">
      <label class="form-label">Layout JSON (editierbar)</label>
      <textarea class="form-control font-monospace" rows="10" id="apJsonTextarea"></textarea>
    </div>
    <input type="hidden" name="layout_json" id="apLayoutInput">
    <div class="form-check form-switch mb-3">
      <input class="form-check-input" type="checkbox" id="apMakeTemplate" name="make_template" value="1" <%= page && page.is_template? 'checked':'' %>>
      <label class="form-check-label" for="apMakeTemplate">Als Template speichern</label>
    </div>
    <div class="mb-3">
      <label class="form-label">Status</label>
      <select class="form-select" name="status">
        <option value="draft" <%= !page || page.status==='draft' ? 'selected' : '' %>>Draft</option>
        <option value="published" <%= page && page.status==='published' ? 'selected' : '' %>>Published</option>
      </select>
      <div class="form-text">Veröffentlichte Seiten erscheinen unter <code>/pages/&lt;slug&gt;</code>.</div>
    </div>
    <div class="mb-5">
      <button class="btn btn-success">Speichern</button>
      <a href="/editors/advanced-pages" class="btn btn-outline-secondary">Zurück</a>
    </div>
  </form>
</div>
<div id="apLayoutData" data-json="<%= encodeURIComponent(layoutJSON) %>"></div>
<script>(function(){ try { var el=document.getElementById('apLayoutData'); window.__AP_INITIAL_LAYOUT = JSON.parse(decodeURIComponent(el.getAttribute('data-json'))); } catch(e){ window.__AP_INITIAL_LAYOUT={version:2,rows:[]}; } })();</script>
<link rel="stylesheet" href="/css/advanced_pages.css">
<script src="/js/advanced_pages_builder.js"></script>
<%- include('partials/footer') %>
