<%- include('partials/header') %>
<%- include('partials/admin_nav') %>
<div class="admin-container container my-5">
    <h2 class="mb-4">Werkzeuge &amp; Debug</h2>
    <p class="text-muted">Dateninspektion & Diagnose (<code><%= mode %></code>).</p>

    <% if(mode==='structured'){ %>
        <h4 class="mt-4">Beiträge (letzte <%= posts.length %>)</h4>
        <div class="table-responsive mb-4">
            <table class="table table-sm table-hover align-middle">
                <thead class="table-light"><tr><th>ID</th><th>Titel</th><th>Status</th><th>Featured</th><th>Gelöscht</th><th>Publiziert</th></tr></thead>
                <tbody>
                <% if(posts.length){ posts.forEach(p=>{ %>
                    <tr><td><%= p.id %></td><td><%= p.title %></td><td><span class="badge bg-<%= p.is_visible?'success':'secondary' %>"><%= p.is_visible?'published':'draft' %></span></td><td><%= p.is_featured?'⭐':'' %></td><td><%= p.is_deleted?'Ja':'-' %></td><td><%= p.published_at? new Date(p.published_at).toISOString().slice(0,16).replace('T',' '):'-' %></td></tr>
                <% }); } else { %><tr><td colspan="6" class="text-center text-muted">Keine Beiträge</td></tr><% } %>
                </tbody>
            </table>
        </div>
        <h4 class="mt-4">Podcasts (letzte <%= podcasts.length %>)</h4>
        <div class="table-responsive mb-4">
            <table class="table table-sm table-hover align-middle">
                <thead class="table-light"><tr><th>ID</th><th>Titel</th><th>SEO Titel</th><th>Publiziert</th></tr></thead>
                <tbody>
                <% if(podcasts.length){ podcasts.forEach(r=>{ %>
                    <tr><td><%= r.id %></td><td><%= r.title %></td><td><%= r.seo_title||'-' %></td><td><%= r.published_at? new Date(r.published_at).toISOString().slice(0,10):'-' %></td></tr>
                <% }); } else { %><tr><td colspan="4" class="text-center text-muted">Keine Podcasts</td></tr><% } %>
                </tbody>
            </table>
        </div>
        <h4 class="mt-4">Advanced Pages (letzte <%= pages.length %>)</h4>
        <div class="table-responsive mb-4">
            <table class="table table-sm table-hover align-middle">
                <thead class="table-light"><tr><th>ID</th><th>Titel</th><th>Slug</th><th>Status</th><th>Template</th><th>Updated</th></tr></thead>
                <tbody>
                <% if(pages.length){ pages.forEach(r=>{ %>
                    <tr><td><%= r.id %></td><td><%= r.title %></td><td><code><%= r.slug %></code></td><td><span class="badge bg-secondary"><%= r.status %></span></td><td><%= r.is_template? 'Ja':'-' %></td><td><%= r.updated_at? r.updated_at.toISOString().slice(0,16).replace('T',' '):'' %></td></tr>
                <% }); } else { %><tr><td colspan="6" class="text-center text-muted">Keine Seiten</td></tr><% } %>
                </tbody>
            </table>
        </div>
    <% } else if(mode==='raw'){ %>
        <ul class="nav nav-pills mb-3 flex-wrap" id="rawTabs">
            <% tables.forEach(function(t,i){ %>
                <li class="nav-item"><button class="nav-link <%= i===0? 'active':'' %>" data-bs-toggle="tab" data-bs-target="#raw-<%= t %>" type="button"><%= t %></button></li>
            <% }); %>
        </ul>
        <div class="tab-content border rounded bg-light" id="rawTabContent" style="max-height:560px; overflow:auto;">
            <% tables.forEach(function(t,i){ %>
                <div class="tab-pane fade <%= i===0? 'show active':'' %> p-3" id="raw-<%= t %>">
                    <h5 class="mb-3"><%= t %></h5>
                    <pre class="small bg-dark text-light p-2 rounded" style="max-height:480px; overflow:auto;"><code><%- JSON.stringify(rawData[t]||[], null, 2) %></code></pre>
                </div>
            <% }); %>
        </div>
    <% } %>
</div>
<%- include('partials/footer') %>
