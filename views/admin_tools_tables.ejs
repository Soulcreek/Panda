<%- include('partials/header') %>
<%- include('partials/admin_nav') %>
<div class="container my-5">
  <h2 class="mb-4">Tabellen Übersicht</h2>
  <p class="text-muted">Struktur der aktuellen Datenbank (Columns & Typen). (<%= tables.length %> Tabellen)</p>
  <div class="accordion" id="tablesAcc">
    <% if (tables && tables.length) { tables.forEach(function(t,i){ const cols = (schemaByTable[t]||[]); %>
      <div class="accordion-item">
        <h2 class="accordion-header" id="head-<%= i %>">
          <button class="accordion-button <%= i>0? 'collapsed':'' %>" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-<%= i %>">
            <strong><%= t %></strong> <span class="badge bg-secondary ms-2"><%= cols.length %> Felder</span>
          </button>
        </h2>
        <div id="collapse-<%= i %>" class="accordion-collapse collapse <%= i===0? 'show':'' %>" data-bs-parent="#tablesAcc">
          <div class="accordion-body p-0">
            <div class="table-responsive">
              <table class="table table-sm mb-0 align-middle">
                <thead class="table-light"><tr><th>Name</th><th>Typ</th><th>Länge</th><th>Null?</th><th>Key</th><th>Extra</th></tr></thead>
                <tbody>
                  <% if(cols.length){ cols.forEach(c=>{ %>
                    <tr>
                      <td><code><%= c.column_name || c.COLUMN_NAME %></code></td>
                      <td><%= c.data_type || c.DATA_TYPE %></td>
                      <td><%= c.character_maximum_length || c.CHARACTER_MAXIMUM_LENGTH || '' %></td>
                      <td><%= (c.is_nullable || c.IS_NULLABLE)==='YES'? 'Ja':'Nein' %></td>
                      <td><%= c.column_key || c.COLUMN_KEY || '' %></td>
                      <td><%= c.extra || c.EXTRA || '' %></td>
                    </tr>
                  <% }); } else { %>
                  <tr><td colspan="6" class="text-center text-muted">Keine Spalten</td></tr>
                  <% } %>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    <% }); } else { %>
      <div class="alert alert-warning">Keine Tabellen gefunden.</div>
    <% } %>
  </div>
</div>
<%- include('partials/footer') %>
