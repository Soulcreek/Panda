<%- include('partials/header') %>
<div class="container my-5">
  <div class="row">
    <div class="col-lg-8 mx-auto" data-aos="fade-up">
      <h1>Account</h1>
      <% if (user) { %>
      <p class="text-muted">User ID: <%= user.id %> | Username: <code><%= user.username %></code></p>
      <h5>Preferences</h5>
      <pre class="small bg-light p-3 rounded"><%= JSON.stringify(prefs || {}, null, 2) %></pre>
      <div class="d-flex flex-wrap gap-3 mt-3">
        <a href="/account/export" class="btn btn-sm btn-outline-primary"><i class="bi bi-download"></i> Export (JSON)</a>
  <form method="POST" action="/account/delete" class="js-account-delete">
          <button type="submit" class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i> Delete</button>
        </form>
      </div>
      <% } else { %>
        <p>Kein Benutzer geladen.</p>
      <% } %>
    </div>
  </div>
</div>
<%- include('partials/footer') %>
<script nonce="<%= cspNonce %>">
document.querySelectorAll('form.js-account-delete').forEach(f=>{
  f.addEventListener('submit', (e)=>{ if(!window.confirm('Delete account? This will anonymize your username.')) e.preventDefault(); });
});
</script>
